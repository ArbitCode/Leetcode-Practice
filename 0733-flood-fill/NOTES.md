call dfs in 4 direction, discard unwanted ranges, and in valid edges.